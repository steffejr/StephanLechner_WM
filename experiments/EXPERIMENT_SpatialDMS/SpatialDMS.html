<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <meta name="description" content="jsPsych Stroop Word">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Jason Steffener, NCMLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCMLab: Spatial DMS</title>
    <!--<link rel="stylesheet" href="jspsych/dist/jspsych.css" />
    <link rel="stylesheet" type='text/css' href='css/survey.css'>
    <link rel="stylesheet" type='text/css' href='css/NCMLabGeneral.css'>-->
    <!--<script src="ImportedModules/jquery-3.6.4.js"></script> 
        <script> 
      // use jquery to load up the header button html content 
      // https://stackoverflow.com/questions/8988855/include-another-html-file-in-a-html-file
      $(function(){$("#headerButtons").load("functions/GeneralPurposeFunctions/HeaderButtons.html");}); 
     
    </script> -->

  </head>    
  <body>
    <!--<div id="headerButtons"></div>
    <script src="jatos.js"></script>
    <script src="jspsych/dist/jspsych.js"></script>-->
    <script src="jspsych_dist/jspsych.js"></script>
    <script src="jspsych_dist/plugin-html-button-response.js"></script>
    <script src="NCMGeneralFunctions.js"></script>
    <script src="General_Setup.js"></script>
    <script src="CommonParts.js"></script>
    <!--<script src="functions/GeneralPurposeFunctions/HeaderFunctions.js"></script>-->
    <script src="StairClass_functions.js"></script>
    <script src="SpatialDMS_functions.js"></script>

    <!--<script src="Batteries/ComponentList.js"></script>-->
    <script src="SpatialDMS_setup.js"></script>

    <script src="SpatialDMS_Instructions.js"></script>
    
    <script src="SpatialDMS_experiment.js"></script>
    <script src="DMS_Scoring.js"></script>
<!--    <div id="jspsych-target"  style="overflow:auto; height:100%" class='center'></div>
  <script>
  var setup = []
  var TrialCount = 1;
 var jsPsych = initJsPsych({
    display_element: 'jspsych-target',
    show_progress_bar: true,    
    auto_update_progress_bar: false,
    on_trial_start: function() {
      //http://127.0.0.1:9000/publix/fNTRhuguK1x
//      console.log(jatos.urlQueryParameters);
      var input = jatos.urlQueryParameters;
      console.log(TrialCount)
      TrialCount += 1
      // Add jatos info to the data file
      jsPsych.data.addProperties({assignedURLID: input.a});
      jsPsych.data.addProperties({jatosWorkerID: jatos.workerId});
      jsPsych.data.addProperties({jatosBatchID: jatos.batchId});
      jsPsych.data.addProperties({jatosStudyName: jatos.studyProperties.title});
      jsPsych.data.addProperties({jatosTaskName: jatos.componentProperties.title});
    },
    on_finish: function() {
      if ( jatos.urlQueryParameters.SaveLocal ) {
          const d = new Date();
          var StrDate = d.getDate() + "_"+String(Number(d.getMonth())+1)+"_"+d.getFullYear();
          var StrTime = d.getHours() + "_"+d.getMinutes();
          var StrDateTime = "_"+StrDate+"__"+StrTime;
          jsPsych.data.get().localSave('csv',jatos.workerId+'_spatialDMS_'+StrDateTime+'.csv');
      }    
      jatos.submitResultData(jsPsych.data.get().json())
      .then(() => whereToGoNext(jatos.studySessionData))

    }
  });
  jatos.onLoad(() => {
      var JATOSID = jatos.workerId;
      console.log(jatos)
      console.log(JATOSID)
      
      var resultsData = {'name':'JASON'};
      jatos.addJatosIds(resultsData);
      jsPsych.run(timeline);
    });
  </script>
-->
  <script>
    
    jatos.onLoad(function() {
    var SPATIAL_DMS_PARAMS = {}
    SPATIAL_DMS_PARAMS.jason = "JASON"

    const subjectId = jatos.studySessionData.subjectId || 'unknown';
    console.log("Subject ID:", subjectId);

    var jsPsych = initJsPsych({
        on_finish: function() {
            saveData();
            showThankYouScreen();
        }
    });

    jsPsych.data.addProperties({
        subject_id: subjectId
    });
    // load params from config file
    // JSON5 parser
    function parseJSON5(json5String) {
        json5String = json5String.replace(/\/\/.*$/gm, '');
        json5String = json5String.replace(/\/\*[\s\S]*?\*\//g, '');
        json5String = json5String.replace(/,(\s*[}\]])/g, '$1');
        return JSON.parse(json5String);
    }

    var SPATIAL_DMS_PARAMS = (() => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'STUDY_GERMANY/sequence_config.json5', false);
        xhr.send();
        const config = parseJSON5(xhr.responseText);
        return config.parameters.spatial_dms;
    })();


    console.log("READING PARAMETERS")
    console.log(SPATIAL_DMS_PARAMS)
    console.log(SPATIAL_DMS_PARAMS.ShowWelcome)
  
      
      var jsPsych = initJsPsych({
          on_finish: function() {
            saveData();
            showThankYouScreen();
        }
      });
  })
</script>
  </body>
</html>